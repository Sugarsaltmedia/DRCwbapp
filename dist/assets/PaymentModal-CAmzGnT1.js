import{j as e,h as F,m as o,k as I,i as L,X as A,l as O,L as T}from"./ui-Cn5rRrbM.js";import{r}from"./vendor-B5ZO-m6Q.js";import{u as q,f as K}from"./index-DT40srAN.js";import{m as Y,n as B,p as H}from"./firebase-JjijnVzV.js";const V=({isOpen:j,onClose:y,onPaymentSuccess:N,onGoToPrivacyPolicy:v,onGoToTermsOfService:g})=>{const[w,M]=r.useState(!1),[S,G]=r.useState(!1),[i,m]=r.useState(!1),[d,P]=r.useState(1),[x,C]=r.useState("A"),[u,z]=r.useState(1),[c,k]=r.useState(""),[l,R]=r.useState(""),{state:a}=q(),b=t=>/^[6-9]\d{9}$/.test(t.replace(/\D/g,"")),_=t=>t.replace(/\D/g,"").slice(0,10),D=()=>new Promise(t=>{const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.onload=()=>t(!0),s.onerror=()=>t(!1),document.body.appendChild(s)}),E=async()=>{const t=c.trim(),s=l.trim();if(!t){alert("Please enter your full name");return}if(!s){alert("Please enter your phone number");return}if(!b(s)){alert("Please enter a valid 10-digit Indian mobile number");return}console.log("ðŸš€ Starting Razorpay payment process..."),m(!0);try{if(!await D())throw new Error("Failed to load Razorpay SDK");console.log("ðŸ’¾ Preparing order for payment...");const p=`order_${Date.now()}`,h={key:"rzp_live_RYS8jZKMNTvoe6",amount:a.total*100,currency:"INR",name:"DRC Cinema Hall",description:"Food Order Payment",receipt:p,handler:function(f){console.log("âœ… Payment successful:",f),$(f),N(d,x,u,c.trim(),l.trim()),m(!1)},prefill:{name:c.trim(),contact:l.trim()},notes:{seat_number:d,row_selection:x,screen_number:u,order_total:a.total},theme:{color:"#0ea5e9"},modal:{ondismiss:function(){console.log("âŒ Payment cancelled by user"),m(!1)}}};console.log("ðŸ’³ Razorpay Config:",{hasKey:!!h.key,keySource:"fallback",amount:h.amount}),new window.Razorpay(h).open()}catch(n){console.error("âŒ Payment setup error:",n),m(!1),alert(`Payment setup failed: ${n instanceof Error?n.message:"Unknown error"}. Please try again.`)}},$=async t=>{console.log("ðŸš€ Saving order to Firestore after successful payment...");try{const s={items:a.items,total:a.total,seatNumber:d,rowSelection:x,screenNumber:u,customerName:c.trim(),customerPhone:l.trim(),timestamp:Y(),status:"ongoing",paymentId:t.razorpay_payment_id,paymentSignature:t.razorpay_signature,orderReceipt:t.razorpay_order_id||`order_${Date.now()}`},n=B(K,"orders"),p=await H(n,s);console.log("ðŸŽ‰ Order saved to Firestore after payment:",p.id)}catch(s){console.error("âŒ Error saving order after payment:",s)}};return j?e.jsx(F,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:y,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsx(o.div,{initial:{opacity:0,scale:.9,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:50},className:"relative w-full max-w-md max-h-[95vh] bg-neutral-950/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-neutral-800 overflow-hidden flex flex-col m-2 sm:m-4",children:S?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(o.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.6},className:"w-20 h-20 bg-success-500/20 rounded-3xl flex items-center justify-center mx-auto mb-6",children:e.jsx(I,{className:"text-success-400",size:40})}),e.jsx("h2",{className:"text-2xl font-bold text-neutral-100 mb-2",children:"Payment Successful!"}),e.jsx("p",{className:"text-neutral-400 mb-6",children:"Your order has been confirmed and is being prepared"}),e.jsx(o.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"text-4xl mb-4",children:"ðŸŽ‰"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-neutral-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-500/20 rounded-xl flex items-center justify-center",children:e.jsx(L,{className:"text-primary-400",size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-100",children:"Place Order"}),e.jsx("p",{className:"text-sm text-neutral-400",children:"Complete your order details"})]})]}),e.jsx("button",{onClick:y,disabled:i,className:"w-10 h-10 rounded-xl bg-neutral-800 hover:bg-neutral-700 flex items-center justify-center text-neutral-400 hover:text-white transition-all duration-300 disabled:opacity-50 border border-neutral-700",children:e.jsx(A,{size:20})})]})}),e.jsxs("div",{className:"p-6 border-b border-neutral-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-100 mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-4",children:a.items.map(t=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("span",{className:"text-neutral-300",children:[t.name," ",t.selectedSize&&`(${t.selectedSize})`," Ã— ",t.quantity]})}),e.jsxs("span",{className:"text-neutral-100 font-medium",children:["â‚¹",t.price*t.quantity]})]},`${t.id}-${t.selectedSize}`))}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Subtotal"}),e.jsxs("span",{className:"text-neutral-100 font-medium text-sm",children:["â‚¹",a.total]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-neutral-400 text-sm",children:"Service Fee"}),e.jsx("span",{className:"text-neutral-100 font-medium text-sm",children:"â‚¹0"})]})]}),e.jsx("div",{className:"border-t border-neutral-800 pt-3 sm:pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base sm:text-lg font-semibold text-neutral-100",children:"Total"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-bold gradient-text",children:["â‚¹",a.total]})]})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-neutral-100 mb-3 sm:mb-4",children:"Customer Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Full Name *"}),e.jsx("input",{type:"text",value:c,onChange:t=>k(t.target.value),placeholder:"Enter your full name",className:"w-full input-field text-sm",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Phone Number *"}),e.jsx("input",{type:"tel",value:l,onChange:t=>R(_(t.target.value)),placeholder:"Enter your phone number",className:"w-full input-field text-sm",maxLength:10,required:!0}),l&&!b(l)&&e.jsx("p",{className:"text-red-400 text-xs",children:"Please enter a valid 10-digit mobile number"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-neutral-100 mb-3 sm:mb-4",children:"Select Your Seat"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Screen"}),e.jsx("select",{value:u,onChange:t=>z(Number(t.target.value)),className:"w-full input-field text-xs sm:text-sm",children:[1,2,3,4].map(t=>e.jsxs("option",{value:t,children:["Screen ",t]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Row"}),e.jsx("select",{value:x,onChange:t=>C(t.target.value),className:"w-full input-field text-xs sm:text-sm",children:["A","B","C","D","E","F","G","H","I","J","K","L"].map(t=>e.jsxs("option",{value:t,children:["Row ",t]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Seat"}),e.jsx("select",{value:d,onChange:t=>P(Number(t.target.value)),className:"w-full input-field text-xs sm:text-sm",children:Array.from({length:50},(t,s)=>s+1).map(t=>e.jsxs("option",{value:t,children:["Seat ",t]},t))})]})]})]}),e.jsxs("div",{className:"bento-card p-3 sm:p-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-primary-500/20 rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"text-primary-400",size:16})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-neutral-100 font-medium text-xs sm:text-sm",children:"Powered by Razorpay"}),e.jsx("p",{className:"text-neutral-500 text-xs",children:"256-bit SSL encrypted payment"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-neutral-400",children:[e.jsx(T,{size:12}),e.jsx("span",{children:"Your payment information is secure"})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-neutral-800 bg-neutral-950/90 backdrop-blur-sm",children:[e.jsx(o.button,{onClick:E,disabled:w,whileHover:i?{}:{scale:1.02},whileTap:i?{}:{scale:.98},className:`w-full py-3 sm:py-4 rounded-xl sm:rounded-2xl font-bold text-base sm:text-lg transition-all duration-300 ${i?"bg-neutral-700 cursor-not-allowed text-neutral-400":"btn-primary"}`,children:i?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-neutral-500 border-t-neutral-300 rounded-full animate-spin"}),"Setting up payment..."]}):`Pay â‚¹${a.total}`}),e.jsxs("div",{className:"text-xs text-neutral-500 text-center mt-3 sm:mt-4 space-y-1",children:[e.jsx("p",{children:"Secure payment powered by Razorpay"}),e.jsxs("p",{children:["By proceeding, you agree to our"," ",e.jsx("button",{onClick:v,className:"text-primary-400 hover:text-primary-300 underline underline-offset-2",children:"Privacy Policy"})," ","and"," ",e.jsx("button",{onClick:g,className:"text-primary-400 hover:text-primary-300 underline underline-offset-2",children:"Terms of Service"})]})]})]})]})})]})}):null};export{V as default};
