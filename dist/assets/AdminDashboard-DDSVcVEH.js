import{j as e,n as S,e as C,i as z,a as E,k as U,U as $,m as u,o as T,p as A,q,r as P,T as L}from"./ui-Cn5rRrbM.js";import{r as o}from"./vendor-B5ZO-m6Q.js";import{f as x}from"./index-DT40srAN.js";import{n as _,q as B,t as H,u as R,w as N,x as M,y as Q}from"./firebase-JjijnVzV.js";const W=({onBackToHome:v,onSignOut:y})=>{const[n,h]=o.useState({}),[w,g]=o.useState(!0),[i,O]=o.useState("all"),[p,j]=o.useState(null);o.useEffect(()=>{console.log("ðŸ”§ Setting up Firestore listener for orders..."),console.log("ðŸ”¥ Firestore instance:",x);const s=_(x,"orders"),t=B(s,H("timestamp","desc"));console.log("ðŸ“ Orders collection reference:",s);const a=R(t,r=>{console.log("ðŸ“¨ Firestore listener triggered"),console.log("ðŸ“Š Snapshot size:",r.size),console.log("ðŸ“Š Snapshot empty:",r.empty);const m={};r.docs.forEach(d=>{var b;const c=d.data();console.log(`ðŸ“„ Firestore Order ${d.id}:`,c);const D=(b=c.timestamp)!=null&&b.toDate?c.timestamp.toDate():new Date(c.timestamp);m[d.id]={id:d.id,...c,timestamp:D}}),console.log("âœ… Orders found in Firestore:",Object.keys(m).length),console.log("ðŸ“‹ Firestore Order IDs:",Object.keys(m)),h(m),console.log("âœ… Orders state updated"),g(!1)},r=>{console.error("âŒ Firestore listener error:",r),console.error("âŒ Error code:",r.code),console.error("âŒ Error message:",r.message),console.error("âŒ Full error object:",r),console.log("ðŸ”„ Setting empty orders due to Firestore error"),h({}),g(!1),alert(`Error connecting to Firestore: ${r.message}. Using demo data.`)});return console.log("ðŸ‘‚ Firestore listener attached"),()=>a()},[]);const F=async(s,t)=>{j(s);try{console.log("ðŸ”„ Updating order status in Firestore:",s,t);const a=N(x,"orders",s);await M(a,{status:t}),console.log("âœ… Firestore order status updated successfully")}catch(a){console.error("âŒ Error updating order status in Firestore:",a),alert(`Error updating order status: ${a instanceof Error?a.message:"Unknown error"}. Please try again.`)}finally{j(null)}},k=async s=>{if(confirm("Are you sure you want to delete this order? This action cannot be undone."))try{console.log("ðŸ—‘ï¸ Deleting order from Firestore:",s);const t=N(x,"orders",s);await Q(t),console.log("âœ… Order deleted from Firestore successfully:",s)}catch(t){console.error("âŒ Error deleting order from Firestore:",t),alert(`Error deleting order from database: ${t instanceof Error?t.message:"Unknown error"}. Please try again.`)}},f=Object.entries(n).filter(([s,t])=>i==="all"?!0:t.status===i).sort(([s,t],[a,r])=>new Date(r.timestamp).getTime()-new Date(t.timestamp).getTime()),l={total:Object.keys(n).length,ongoing:Object.values(n).filter(s=>s.status==="ongoing").length,completed:Object.values(n).filter(s=>s.status==="completed").length,revenue:Object.values(n).reduce((s,t)=>s+t.total,0)};return w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-neutral-950 via-neutral-900 to-neutral-950 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-400",children:"Connecting to Firestore..."}),e.jsx("p",{className:"text-neutral-500 text-sm mt-2",children:"If this takes too long, check Firestore configuration"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-neutral-950 via-neutral-900 to-neutral-950",children:[e.jsx("div",{className:"sticky top-0 z-40 bg-neutral-950/80 backdrop-blur-xl border-b border-neutral-800/50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("button",{onClick:y,className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-neutral-800 hover:bg-neutral-700 flex items-center justify-center text-neutral-300 hover:text-white transition-all duration-300 border border-neutral-700 hover:border-neutral-600",children:e.jsx(S,{size:16,className:"sm:w-5 sm:h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-neutral-100",children:"Admin Dashboard"}),e.jsx("p",{className:"text-xs sm:text-sm text-neutral-400 hidden sm:block",children:"Manage all orders and track performance"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:v,className:"btn-secondary flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 text-xs sm:text-sm",children:[e.jsx(C,{size:14,className:"sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Home"}),e.jsx("span",{className:"sm:hidden",children:"Home"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx("div",{className:"bento-card p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-primary-500/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx(z,{className:"text-primary-400",size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-xs sm:text-sm",children:"Total Orders"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-neutral-100",children:l.total})]})]})}),e.jsx("div",{className:"bento-card p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-amber-500/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx(E,{className:"text-amber-400",size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-xs sm:text-sm",children:"Ongoing"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-neutral-100",children:l.ongoing})]})]})}),e.jsx("div",{className:"bento-card p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-success-500/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx(U,{className:"text-success-400",size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-xs sm:text-sm",children:"Completed"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-neutral-100",children:l.completed})]})]})}),e.jsx("div",{className:"bento-card p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-accent-500/20 rounded-lg sm:rounded-xl flex items-center justify-center",children:e.jsx($,{className:"text-accent-400",size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-400 text-xs sm:text-sm",children:"Revenue"}),e.jsxs("p",{className:"text-lg sm:text-2xl font-bold gradient-text",children:["â‚¹",l.revenue]})]})]})})]}),e.jsx("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto pb-2",children:["all","ongoing","completed"].map(s=>e.jsxs("button",{onClick:()=>O(s),className:`px-3 sm:px-4 py-2 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 border whitespace-nowrap ${i===s?"bg-primary-500 text-white border-primary-500 shadow-lg shadow-primary-500/25":"bg-neutral-800 text-neutral-300 border-neutral-700 hover:bg-neutral-700 hover:border-neutral-600"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),s!=="all"&&e.jsx("span",{className:"ml-1 sm:ml-2 px-1.5 sm:px-2 py-0.5 bg-white/20 rounded-full text-xs",children:s==="ongoing"?l.ongoing:l.completed})]},s))})]})}),e.jsx("div",{className:"max-w-7xl mx-auto p-2 sm:p-4",children:f.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(u.div,{animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},className:"text-6xl mb-6",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-2xl font-bold text-neutral-300 mb-2",children:"No orders found"}),e.jsx("p",{className:"text-neutral-500",children:i==="all"?"No orders have been placed yet":`No ${i} orders`})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:f.map(([s,t])=>e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bento-card p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold text-neutral-100",children:["Order #",s.slice(-8)]}),e.jsx("div",{className:`px-2 sm:px-3 py-1 rounded-full text-xs font-medium ${t.status==="ongoing"?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-success-500/20 text-success-300 border border-success-500/30"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-neutral-400",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{size:12,className:"sm:w-3.5 sm:h-3.5"}),e.jsx("span",{children:new Date(t.timestamp).toLocaleString()})]})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg sm:text-xl lg:text-2xl font-bold gradient-text",children:["â‚¹",t.total]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-neutral-300 font-medium text-xs sm:text-sm flex items-center gap-2",children:[e.jsx(A,{size:12,className:"sm:w-3.5 sm:h-3.5"}),"Customer Details"]}),e.jsxs("div",{className:"space-y-1 text-xs sm:text-sm text-neutral-400",children:[e.jsxs("div",{children:["Name: ",t.customerName]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{size:10,className:"sm:w-3 sm:h-3"}),t.customerPhone]})]})]}),t.seatNumber&&t.rowSelection&&t.screenNumber&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-neutral-300 font-medium text-xs sm:text-sm flex items-center gap-2",children:[e.jsx(P,{size:12,className:"sm:w-3.5 sm:h-3.5"}),"Seat Details"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-neutral-400",children:[e.jsxs("span",{children:["Screen ",t.screenNumber]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Row ",t.rowSelection]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Seat ",t.seatNumber]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-neutral-300 font-medium text-xs sm:text-sm",children:"Order Items"}),e.jsx("div",{className:"space-y-1",children:t.items.map((a,r)=>e.jsxs("div",{className:"flex justify-between items-center text-xs sm:text-sm",children:[e.jsxs("span",{className:"text-neutral-400",children:[a.name,a.selectedSize&&` (${a.selectedSize})`,e.jsxs("span",{className:"text-neutral-500 ml-2",children:["Ã— ",a.quantity]})]}),e.jsxs("span",{className:"text-neutral-300 font-medium",children:["â‚¹",a.price*a.quantity]})]},r))})]})]}),e.jsx("div",{className:"flex flex-col justify-center lg:min-w-[160px]",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium text-neutral-300",children:"Update Status"}),e.jsxs("select",{value:t.status,onChange:a=>F(s,a.target.value),disabled:p===s,className:"input-field w-full lg:w-40 text-xs sm:text-sm",children:[e.jsx("option",{value:"ongoing",children:"Ongoing"}),e.jsx("option",{value:"completed",children:"Completed"})]}),p===s&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-primary-400",children:[e.jsx("div",{className:"w-3 h-3 border border-primary-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Updating..."})]}),e.jsxs(u.button,{onClick:()=>k(s),disabled:p===s,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full lg:w-40 px-3 sm:px-4 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 hover:border-red-500/50 rounded-lg sm:rounded-xl text-red-400 hover:text-red-300 font-medium text-xs sm:text-sm transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(L,{size:12,className:"sm:w-3.5 sm:h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Delete Order"}),e.jsx("span",{className:"sm:hidden",children:"Delete"})]})]})})]})},s))})})]})};export{W as default};
